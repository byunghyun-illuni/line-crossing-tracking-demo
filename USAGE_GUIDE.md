# 2D Access Control MVP 사용 가이드

## 🚀 빠른 시작

### 1. 환경 설정

```bash
# 프로젝트 디렉토리로 이동
cd line-crossing-tracking-demo

# 의존성 설치 (이미 설치되어 있다면 생략)
pip install -e .
```

### 2. 테스트 비디오 생성 (선택사항)

```bash
# 테스트용 비디오 파일 생성
python create_test_video.py
```

### 3. 애플리케이션 실행

#### 방법 1: 실행 스크립트 사용 (권장)
```bash
python run_app.py
```

#### 방법 2: 직접 실행
```bash
# macOS에서 카메라 권한 문제 해결
export OPENCV_AVFOUNDATION_SKIP_AUTH=1

# Streamlit 앱 실행
streamlit run streamlit_app/main.py --server.port 8501
```

## 📹 비디오 소스 설정

### 비디오 파일 업로드

1. **사이드바**에서 "📁 비디오 파일 업로드" 선택
2. **파일 업로드** 섹션에서 비디오 파일 선택
   - 지원 형식: MP4, AVI, MOV, MKV
3. **"📁 파일 로드"** 버튼 클릭
4. 성공 메시지 확인

### 실시간 카메라

1. **사이드바**에서 "📹 실시간 카메라" 선택
2. **카메라 설정** 섹션에서 카메라 ID 입력 (보통 0)
3. **"📹 카메라 연결"** 버튼 클릭

#### macOS 카메라 권한 문제 해결

카메라 연결이 안 되는 경우:

1. **시스템 환경설정** > **보안 및 개인정보보호** > **카메라**
2. 터미널 또는 Python에 카메라 권한 부여
3. 다른 카메라 ID 시도 (0, 1, 2 등)

## 🎯 객체 추적 설정

### 트래커 초기화

1. **사이드바**의 "🎯 추적 설정" 섹션
2. **신뢰도 임계값** 조정 (0.1 ~ 1.0, 기본값: 0.6)
   - 높을수록 정확하지만 감지 수 감소
   - 낮을수록 많이 감지하지만 오탐 증가
3. **"🔧 트래커 초기화"** 버튼 클릭

### 추적 시작/정지

1. **"▶️ 시작"** 버튼: 추적 시작
2. **"⏹️ 정지"** 버튼: 추적 정지
3. **"🔄 리셋"** 버튼: 시스템 전체 리셋

## 📊 모니터링 화면

### 실시간 비디오

- **메인 화면**: 추적 결과가 표시된 실시간 비디오
- **바운딩 박스**: 감지된 객체 주위에 표시
- **트랙 ID**: 각 객체의 고유 식별번호
- **신뢰도**: 감지 정확도 (0.0 ~ 1.0)

### 통계 정보

- **프레임**: 처리된 총 프레임 수
- **총 감지**: 감지된 객체의 총 개수
- **라인 교차**: 가상 라인을 교차한 이벤트 수

### 최근 이벤트

- 최근 감지된 객체들의 정보
- 트랙 ID, 클래스, 신뢰도 표시

## 🛠️ 고급 설정

### OC-SORT 파라미터 조정

코드에서 직접 수정 가능한 파라미터들:

```python
tracker = ObjectTracker(
    det_thresh=0.6,        # 감지 임계값
    max_age=30,           # 최대 추적 유지 프레임
    min_hits=3,           # 추적 시작 최소 감지 수
    iou_threshold=0.3,    # IoU 임계값
    delta_t=3,            # 속도 계산 시간 간격
    asso_func="iou",      # 연관 함수 ("iou", "giou", "ciou", "diou")
    inertia=0.2,          # 관성 계수
    use_byte=False        # ByteTrack 사용 여부
)
```

## 🔧 문제 해결

### 일반적인 문제들

#### 1. 카메라 연결 실패
```
OpenCV: not authorized to capture video (status 0)
```

**해결방법:**
- macOS: 시스템 환경설정에서 카메라 권한 부여
- 환경 변수 설정: `export OPENCV_AVFOUNDATION_SKIP_AUTH=1`
- 다른 카메라 ID 시도

#### 2. 비디오 파일 로드 실패
```
비디오 파일을 열 수 없습니다
```

**해결방법:**
- 지원되는 형식인지 확인 (MP4, AVI, MOV, MKV)
- 파일 경로에 특수문자나 한글이 없는지 확인
- 파일이 손상되지 않았는지 확인

#### 3. 추적 성능 저하

**해결방법:**
- 신뢰도 임계값 조정
- 비디오 해상도 낮추기
- 프레임 레이트 조정

#### 4. 메모리 부족

**해결방법:**
- 시스템 리셋 (🔄 리셋 버튼)
- 브라우저 새로고침
- 애플리케이션 재시작

### 로그 확인

터미널에서 실행 시 상세한 로그 메시지 확인 가능:

```bash
# 디버그 모드로 실행
PYTHONPATH=. python -c "
import logging
logging.basicConfig(level=logging.DEBUG)
exec(open('streamlit_app/main.py').read())
"
```

## 📝 테스트 시나리오

### 1. 기본 테스트

1. 테스트 비디오 생성: `python create_test_video.py`
2. 애플리케이션 실행: `python run_app.py`
3. 비디오 파일 업로드
4. 트래커 초기화
5. 추적 시작

### 2. 실시간 테스트

1. 웹캠 연결
2. 카메라 모드 선택
3. 실시간 추적 테스트

### 3. 성능 테스트

1. 다양한 신뢰도 임계값으로 테스트
2. 다른 연관 함수 비교
3. 프레임 레이트 측정

## 🎯 다음 단계

### 기능 확장

1. **가상 라인 설정**: 사용자가 직접 라인 그리기
2. **다중 클래스 지원**: 사람 외 다른 객체 추적
3. **이벤트 알림**: 라인 교차 시 알림 기능
4. **데이터 저장**: 추적 결과 CSV/JSON 저장
5. **실시간 스트리밍**: RTMP/WebRTC 지원

### 성능 최적화

1. **GPU 가속**: CUDA 지원
2. **모델 최적화**: TensorRT, ONNX 변환
3. **멀티스레딩**: 병렬 처리
4. **메모리 최적화**: 프레임 버퍼링

## 📞 지원

문제가 발생하거나 질문이 있으시면:

1. **GitHub Issues**: 버그 리포트 및 기능 요청
2. **로그 파일**: 터미널 출력 내용 첨부
3. **환경 정보**: OS, Python 버전, 카메라 모델 등

---

**Happy Tracking! 🎯** 