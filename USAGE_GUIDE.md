# 2D Access Control MVP 사용 가이드

## 🚀 빠른 시작

### 1. 환경 설정

```bash
# 프로젝트 디렉토리로 이동
cd line-crossing-tracking-demo

# 의존성 설치 (이미 설치되어 있다면 생략)
pip install -e .
```

### 2. 애플리케이션 실행

#### 방법 1: 실행 스크립트 사용 (권장)
```bash
python run_app.py
```

#### 방법 2: 직접 실행
```bash
# macOS에서 카메라 권한 문제 해결
export OPENCV_AVFOUNDATION_SKIP_AUTH=1

# Streamlit 앱 실행
streamlit run streamlit_app/main.py --server.port 8501
```

## 📹 사용 방법

### 🎯 간단한 사용 순서

1. **브라우저에서 http://localhost:8501 접속**
2. **비디오 소스 선택**:
   - 📁 비디오 파일 업로드 (권장)
   - 📹 실시간 카메라
3. **원클릭 시작**: "📁 파일 로드 및 시작" 또는 "📹 카메라 연결 및 시작" 버튼 클릭
4. **완료!** 자동으로 추적이 시작됩니다

### 📁 비디오 파일 사용

1. **사이드바**에서 "📁 비디오 파일 업로드" 선택
2. **신뢰도 임계값** 조정 (기본값: 0.6)
3. **파일 업로드** 섹션에서 비디오 파일 선택
   - 지원 형식: MP4, AVI, MOV, MKV
4. **"📁 파일 로드 및 시작"** 버튼 클릭
5. ✅ 시스템이 자동으로 트래커를 초기화하고 추적을 시작합니다

### 📹 실시간 카메라 사용

1. **사이드바**에서 "📹 실시간 카메라" 선택
2. **신뢰도 임계값** 조정 (기본값: 0.6)
3. **카메라 ID** 입력 (보통 0)
4. **"📹 카메라 연결 및 시작"** 버튼 클릭
5. ✅ 시스템이 자동으로 카메라에 연결하고 추적을 시작합니다

#### macOS 카메라 권한 문제 해결

카메라 연결이 안 되는 경우:

1. **시스템 환경설정** → **보안 및 개인정보보호** → **카메라**
2. **터미널** 또는 **Python** 앱에 카메라 권한 부여
3. 터미널에서 다음 명령어 실행:
   ```bash
   export OPENCV_AVFOUNDATION_SKIP_AUTH=1
   ```

## 🎮 제어 기능

### 상태 표시
- ✅ **시스템 준비 완료**: 비디오 소스와 트래커가 모두 준비됨
- ⚠️ **비디오 소스를 선택해주세요**: 아직 비디오가 로드되지 않음

### 제어 버튼
- **▶️ 재생 / ⏸️ 일시정지**: 추적 재생/일시정지 토글
- **⏹️ 정지**: 추적 완전 정지
- **🔄 리셋**: 시스템 전체 리셋

## 📊 모니터링 기능

### 실시간 통계
- **프레임**: 처리된 총 프레임 수
- **총 감지**: 감지된 총 객체 수
- **라인 교차**: 라인을 교차한 이벤트 수

### 이벤트 로그
- 최근 감지된 객체들의 정보 표시
- 객체 ID, 클래스, 신뢰도 정보 포함

## 🔧 설정 옵션

### 추적 설정
- **신뢰도 임계값**: 0.1 ~ 1.0 (기본값: 0.6)
  - 높을수록 더 확실한 객체만 감지
  - 낮을수록 더 많은 객체를 감지하지만 오탐 가능성 증가

## 🎥 테스트 비디오 생성

```bash
# 테스트용 비디오 파일 생성 (선택사항)
python create_test_video.py
```

이 명령어는 움직이는 객체들이 있는 10초 길이의 테스트 비디오(`test_video.mp4`)를 생성합니다.

## 🐛 문제 해결

### 일반적인 문제들

1. **"비디오 소스와 트래커를 먼저 설정해주세요" 오류**
   - ✅ **해결됨**: 이제 "파일 로드 및 시작" 버튼으로 원클릭 해결

2. **카메라 연결 실패**
   - 다른 카메라 ID 시도 (0, 1, 2...)
   - macOS 카메라 권한 확인
   - 다른 앱에서 카메라 사용 중인지 확인

3. **비디오 파일 로드 실패**
   - 지원되는 형식인지 확인 (MP4, AVI, MOV, MKV)
   - 파일이 손상되지 않았는지 확인

4. **추적 성능 문제**
   - 신뢰도 임계값 조정
   - 비디오 해상도 확인

### 로그 확인

```bash
# 실시간 로그 확인
tail -f streamlit_app.log
```

## 📝 주요 개선사항

### v2.0 업데이트 (현재 버전)
- ✅ **원클릭 시작**: 파일 로드와 추적 시작을 한 번에
- ✅ **자동 트래커 초기화**: 별도 초기화 버튼 불필요
- ✅ **직관적인 UX**: 복잡한 3단계 → 간단한 1단계
- ✅ **상태 표시**: 시스템 준비 상태를 명확히 표시
- ✅ **재생/일시정지**: 토글 방식으로 더 직관적인 제어

### 이전 버전의 문제점
- ❌ 복잡한 3단계 과정: 파일 로드 → 트래커 초기화 → 시작
- ❌ 혼란스러운 버튼 순서
- ❌ 불명확한 시스템 상태

## 🎯 사용 팁

1. **처음 사용자**: 테스트 비디오부터 시작해보세요
2. **성능 최적화**: 신뢰도 임계값을 0.7~0.8로 설정
3. **실시간 모니터링**: 이벤트 로그를 통해 감지 상태 확인
4. **문제 발생시**: 🔄 리셋 버튼으로 시스템 초기화

---

**문의사항이나 버그 리포트는 GitHub Issues를 통해 제출해주세요.** 